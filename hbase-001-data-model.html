<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#fff">



  
  
    
      
    
    
      
    
  <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
  <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-flash.min.css" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="https://fonts.cat.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Roboto Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






  

<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.css" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/Pixel_Art_32px.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/Pixel_Art_16px.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#fff">





  <meta name="keywords" content="Hbase,翻译,Guide,大数据," />










<meta name="description" content="校验Hbase官方指南文档Apache HBase ™ Reference Guide Version 3.0.0-SNAPSHOT   Data Model部分No.20到No.32小节">
<meta name="keywords" content="Hbase,翻译,Guide,大数据">
<meta property="og:type" content="article">
<meta property="og:title" content="Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」">
<meta property="og:url" content="https://peniridis.github.io/hbase-001-data-model.html">
<meta property="og:site_name" content="Winter Coderʕ•͓͡•͡ʔ">
<meta property="og:description" content="校验Hbase官方指南文档Apache HBase ™ Reference Guide Version 3.0.0-SNAPSHOT   Data Model部分No.20到No.32小节">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-09-17T12:15:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」">
<meta name="twitter:description" content="校验Hbase官方指南文档Apache HBase ™ Reference Guide Version 3.0.0-SNAPSHOT   Data Model部分No.20到No.32小节">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":true},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"perspectiveLeftIn","post_header":"fadeIn","post_body":"fadeIn","coll_header":"perspectiveLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://peniridis.github.io/hbase-001-data-model.html"/>





  <title>Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」 | Winter Coderʕ•͓͡•͡ʔ</title><!-- hexo-inject:begin --><!-- hexo-inject:end -->
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Winter Coderʕ•͓͡•͡ʔ</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Welcom to the jungle.</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://peniridis.github.io/hbase-001-data-model.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="一打鹏">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/ajie.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Winter Coderʕ•͓͡•͡ʔ">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-09-17T13:56:03+08:00">
                2018-09-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/hbase-001-data-model.html" class="leancloud_visitors" data-flag-title="Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">
              
                
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">字数统计&#58;</span>
                
                <span title="字数统计">
                  4.7k
                </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">
                  17
                </span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <blockquote>
<p>校验Hbase官方指南文档<a href="https://hbase.apache.org/book.html" target="_blank" rel="noopener">Apache HBase ™ Reference Guide Version 3.0.0-SNAPSHOT</a></p>
</blockquote>
<blockquote>
<p>Data Model部分No.20到No.32小节</p>
</blockquote>
<a id="more"></a>
<p><span class="citation" data-cites="toc">@toc</span></p>
<h2 id="数据模型">数据模型</h2>
<p>在HBase中，数据存储在具有行和列的表中。关系型数据库（RDBMS）中有相似的概念，这并不是有用的类比。不过，HBase可以被认为是一个多维度的数据映射存储。</p>
<p><strong>HBase Data Model Terminology Hbase（数据模型术语）</strong></p>
<ul>
<li>Table（表）</li>
</ul>
<p>HBase表由多行组成。</p>
<ul>
<li>Row（列）</li>
</ul>
<p>HBase中的一行由一个行键和一个或多个具有与之关联的值的列组成。行存储时，行按字母顺序排序。因此，行的key的设计就显得非常重要。数据的存储目标是相近的数据存储到一起。一个常用的行的key的格式是网站域名。如果你的行的key是域名，你应该将域名进行反转(org.apache.www, org.apache.mail, org.apache.jira)再存储。这样的话，所有Apache域名将会存储在一起，而不是基于子域名的首字母分散在各处。</p>
<ul>
<li>Column（列）</li>
</ul>
<p>HBase中的列包含用「:」(冒号)分隔开的列族和列的限定符。</p>
<ul>
<li>Column Family（列族）</li>
</ul>
<p>因为性能的原因，列族物理上包含一组列和它们的值。每一个列族拥有一系列的存储属性，例如值是否缓存在内存中，数据是否要压缩或者他的行key是否要加密等等。表格中的每一行拥有相同的列族，尽管一个给定的行可能没有存储任何数据在一个给定的列族中。</p>
<ul>
<li>Column Qualifier（列限定符）</li>
</ul>
<p>列的限定符是列族中数据的索引。例如给定了一个列族<code>content</code>，那么限定符可能是<code>content:html</code>，也可以是<code>content:pdf</code>。列族在创建表格时是确定的了，但是列的限定符是可变的，并且行之间可能有很大差异。</p>
<ul>
<li>Cell（单元）</li>
</ul>
<p>单元是由行、列族、列限定符、值和代表值版本的时间戳组成的。</p>
<ul>
<li>Timestamp（时间戳）</li>
</ul>
<p>时间戳是写在值旁边的一个用于区分值的版本的数据。默认情况下，时间戳表示的是当数据写入时RegionSever的时间点，但你也可以在写入数据时指定一个不同的时间戳。</p>
<h2 id="概念视图">概念视图</h2>
<p>你可以读一下 Jim R写的<a href="http://jimbojw.com/wiki/index.php?title=Understanding_Hbase_and_BigTable" target="_blank" rel="noopener">Understanding HBase and BigTable</a> 博客来简单了解一下HBase的数据模型，另一个好的理解是Amandeep Khurana.的 <a href="http://0b4af6cdc2f0c5998459-c0245c5c937c5dedcca3f1764ecc9b2f.r43.cf2.rackcdn.com/9353-login1210_khurana.pdf" target="_blank" rel="noopener">Introduction to Basic Schema Design</a> 。</p>
<p>学习不同的方面的资料可能会帮助你更透彻地了解HBase的设计。所链接的文章覆盖本部分所讲的信息。</p>
<p>接下来的例子是 取自<a href="http://research.google.com/archive/bigtable.html" target="_blank" rel="noopener">BigTable</a> 中第二页中的例子，在此基础上做了些许的改变。一个名为webable的表格，表格中有两行（com.cnn.www 和 com.example.www）和三个列族（contents, anchor, 和 people）。在这个例子当中，第一行(com.cnn.www)中anchor包含两列（anchor:cssnsi.com, anchor:my.look.ca）和content包含一列（contents:html）。这个例子中com.cnn.www拥有5个版本而com.example.www有一个版本。contents:html列中包含给定网页的整个HTML。anchor限定符包含能够表示行的站点以及链接中文本。People列族表示跟站点有关的人。</p>
<blockquote>
<p>列名 按照所定义好的，一个列名的格式为列族名前缀加限定符。例如，列contents:html由列族contents和html限定符。冒号「:」用于将列族和列限定符分开。</p>
</blockquote>
<p>Table 6. Table <code>webtable</code></p>
<table>
<thead>
<tr class="header">
<th>行键</th>
<th>时间戳</th>
<th>列族contents</th>
<th>列族anchor</th>
<th>列族people</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t9</td>
<td></td>
<td>anchor:cnnsi.com = “CNN”</td>
<td></td>
</tr>
<tr class="even">
<td>“com.cnn.www”</td>
<td>t8</td>
<td></td>
<td>anchor:cnnsi.com = “CNN”</td>
<td></td>
</tr>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t6</td>
<td>contents:html = “&lt;html&gt;…​”</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>“com.cnn.www”</td>
<td>t5</td>
<td>contents:html = “&lt;html&gt;…​”</td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t3</td>
<td>contents:html = “&lt;html&gt;…​”</td>
<td></td>
<td></td>
</tr>
<tr class="even">
<td>“com.example.www”</td>
<td>t5</td>
<td>contents:html = “&lt;html&gt;…​”</td>
<td></td>
<td>people:author = “John Doe”</td>
</tr>
</tbody>
</table>
<p>在HBase中，表格中的单元如果是空将不占用空间或者事实上不存在。这就使得HBase看起来“稀疏”。表格视图不是唯一方式来查看HBase中数据，甚至不是最精确的。下面的方式以多维度映射的方式来表达相同的信息。这只是一个说明示例的模型可能不是严格准确的。</p>
<!--￼0-->
<h2 id="物理视图">物理视图</h2>
<p>尽管在概念层次，表可能看起来是由一些列稀疏的行组成，但他们是通过列族来存储的。一个新建的限定符(column_family:column_qualifier)可以随时地添加到已存在的列族中。 <em>Table 7. 列族 <code>anchor</code></em></p>
<table>
<thead>
<tr class="header">
<th>行键</th>
<th>时间戳</th>
<th style="text-align: center;">列族anchor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t9</td>
<td style="text-align: center;">anchor:cnnsi.com = “CNN”</td>
</tr>
<tr class="even">
<td>“com.cnn.www”</td>
<td>t8</td>
<td style="text-align: center;">anchor:my.look.ca = “CNN.com”</td>
</tr>
</tbody>
</table>
<p><em>Table 8. 列族 <code>contents</code></em></p>
<table>
<thead>
<tr class="header">
<th>行键</th>
<th>时间戳</th>
<th>列族contents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t6</td>
<td>contents:html = “&lt;html&gt;…​”</td>
</tr>
<tr class="even">
<td>“com.cnn.www”</td>
<td>t5</td>
<td>contents:html = “&lt;html&gt;…​”</td>
</tr>
<tr class="odd">
<td>“com.cnn.www”</td>
<td>t3</td>
<td>contents:html = “&lt;html&gt;…​”</td>
</tr>
</tbody>
</table>
<p>概念视图中的空单元实际上是没有进行存储的。因此对于返回时间戳为t8的<code>contents:html</code>的值的请求，结果为空。同样的，一个返回时间戳为t9的<code>anchor:my.look.ca</code>的值的请求，结果也为空。然而，如果没有指定时间戳的话，那么会返回特定列的最新值。对有多个版本的列，优先返回最新的值，因为时间戳是按照递减顺序存储的。因此对于一个返回<code>com.cnn.www</code>里面所有的列的值并且没有指定时间戳的请求，返回的结果会是时间戳为t6的<code>contents:html</code>的值、时间戳 t9的<code>anchor:cnnsi.com</code>的值和时间戳t8的 <code>anchor:my.look.ca</code> 。</p>
<p>关于Apache Hbase如何存储数据的内部细节，请查看 <a href="http://hbase.apache.org/book.html#regions.arch" target="_blank" rel="noopener">regions.arch</a>.</p>
<h2 id="命名空间">命名空间</h2>
<p>命名空间是一个类似于关系型数据库系统中的数据库的逻辑上的表分组的概念。这个抽象的概念为即将到来的多租户相关特性奠定了基础：</p>
<ul>
<li>配额管理 (<a href="https://issues.apache.org/jira/browse/HBASE-8410" target="_blank" rel="noopener">HBASE-8410</a>) - 限制命名空间可以使用的资源量（即区域，表）。</li>
<li>命名空间安全管理 (<a href="https://issues.apache.org/jira/browse/HBASE-9206" target="_blank" rel="noopener">HBASE-9206</a>) - 为租户提供另一级别的安全管理。</li>
<li>区域服务器组 (<a href="https://issues.apache.org/jira/browse/HBASE-6721" target="_blank" rel="noopener">HBASE-6721</a>) - 可以将命名空间/表固定到RegionServers的子集上，从而保证粗略的隔离级别。</li>
</ul>
<h3 id="命名空间管理">命名空间管理</h3>
<p>命名空间可以被创建、移除和修改。命名空间关系的指定是在创建表格通过指定一个完全限定表名的形式完成的：</p>
<!--￼1-->
<p><em>Example 7. Examples</em></p>
<!--￼2-->
<h3 id="预定义命名空间">预定义命名空间</h3>
<p>有两种预定义的特殊的命名空间</p>
<ul>
<li>hbase – 系统命名空间, 用于包含HBase内部表</li>
<li>default – 没有明确指定命名空间的表将会自动落入这个命名空间</li>
</ul>
<p><em>Example 8. Examples</em></p>
<!--￼3-->
<h2 id="表">表</h2>
<p>在Schema（模式）定义时预先声明表。</p>
<h2 id="行">行</h2>
<p>行键是未解释的字节。行是按照字典顺序进行排序的并且最小的排在前面。空的字节数据用来表示表格的命名空间的开头和结尾。</p>
<h2 id="列族">列族</h2>
<p>列在HBase中是归入到列族里面的。一个列族的所有列成员都有相同的前缀。例如，列<code>courses:history</code>和<code>cources:math</code>是cources列族的成员，冒号用于将列族和列限定符分开。列族前缀必须由可打印输出的字符组成。列限定符可以由任意字节组成。列族必须在结构定义阶段预先声明好，而列则不需要在结构设计阶段预先定义，而是可以在表的创建和运行阶段动态生成。</p>
<p>物理上来说，所有的列族成员都是存储在文件系统。因为调试和存储参数都是在列族级别完成，建议所有的列族都要拥有相同的访问模式和大小特征。</p>
<h2 id="单元">单元</h2>
<p>一个{row,column,version}完全指定了HBase的一个单元。单元内容是未解释的字节</p>
<h2 id="数据模型操作">数据模型操作</h2>
<p>数据模型的四个主要操作是Get，Put，Scan和Delete。可以通过Table实例进行操作。</p>
<h3 id="get">Get</h3>
<p><a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Get.html" target="_blank" rel="noopener">Get</a> 返回指定行的属性 Gets 通过 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Table.html#get(org.apache.hadoop.hbase.client.Get)" target="_blank" rel="noopener">Table.get</a>.执行。</p>
<h3 id="put">Put</h3>
<p><a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Put.html" target="_blank" rel="noopener">Put</a> 操作是在行键不存在时添加新行或者行键已经存在时进行更新。 Puts 是通过 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Table.html#put(org.apache.hadoop.hbase.client.Put)" target="_blank" rel="noopener">Table.put</a> (写缓存) 或者<a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Table.html#batch(java.util.List,%20java.lang.Object%5B%5D)" target="_blank" rel="noopener">Table.batch</a> (没有写缓存)执行的。</p>
<h3 id="scans">Scans</h3>
<p><a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Scan.html" target="_blank" rel="noopener">Scan</a> 允许为指定属性迭代多行。</p>
<p>下面是表格实例中Scan的例子。假设一个表格里面有“row1”, “row2”, “row3”，然后有另外一组行键为“abc1”, “abc2”,和“abc3”。下面的例子展示如何设置一个Scan实例来返回以“row”开头的行。</p>
<!--￼4-->
<p>需要说明的是通常最简单的指定Scan的一个特定停止点的方法是使用<a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/filter/InclusiveStopFilter.html" target="_blank" rel="noopener">InclusiveStopFilter</a> 类。</p>
<h3 id="delete">Delete</h3>
<p><a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Delete.html" target="_blank" rel="noopener">Delete</a> 操作是将一个行从表中移除. Deletes 通过 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Table.html#delete(org.apache.hadoop.hbase.client.Delete)" target="_blank" rel="noopener">Table.delete</a>执行。</p>
<p>HBase不会立刻对数据的进行操作（可以理解为不对数据执行删除操作），而是为死亡数据创建一个称为墓碑的标签。这个墓碑和死亡数据会在重要精简工作中被删除。</p>
<p>查看 <a href="http://hbase.apache.org/book.html#version.delete" target="_blank" rel="noopener">version.delete</a> 获取更多关于列的版本删除的信息，查看 <a href="http://hbase.apache.org/book.html#compaction" target="_blank" rel="noopener">compaction</a> 获取关于压缩工作的更多信息。</p>
<h2 id="版本">版本</h2>
<p>A <em>{row, column, version}</em> 在HBase完全指定一个单元。理论上来说行和列都一样的单元的数量是无限的，因为单元的地址是通过版本这个维度来区分的。</p>
<p>行和列使用字节来表达，而版本是通过长整型来指定的。典型来说，这个长时间实例就像<code>java.util.Date.getTime()</code> 或者 System.currentTimeMillis()返回的一样，以毫秒为单位，返回当前时间和 <em>January 1, 1970 UTC的时间差</em> 。</p>
<p>HBase的版本维度以递减顺序存储，以致读取一个存储的文件时，返回的是最新版本的数据。</p>
<p>关于单元的版本有许多的困扰，尤其是：</p>
<ul>
<li>如果多个数据写到一个具有相同版本的单元里，只能获取到最后写入的那个</li>
<li>以非递增的版本顺序写入也是可以的。</li>
</ul>
<p>下面我们将描述HBase中版本维度是如何运作的。可以看 <a href="https://issues.apache.org/jira/browse/HBASE-2406" target="_blank" rel="noopener">HBASE-2406</a> 关于HBase版本的讨论。 <a href="http://outerthought.org/blog/417-ot.html" target="_blank" rel="noopener">Bending time in HBase</a> 是关于HBase的版本或者时间维度的好读物。它提供了比这里更多的关于版本的细节信息。正如这里写到的，这里提到的_覆盖存在的时间戳_的限制将不再存在。这部分只是Bruno Dumon所写的关于版本的基本大纲。</p>
<h3 id="指定版本的存储数量">指定版本的存储数量</h3>
<p>版本的最大存储数量是列结构的一个部分并且在表格创建时指定，或者通过<code>alter</code>命令行，或者通过 <code>HColumnDescriptor.DEFAULT_VERSIONS</code>来修改。HBase0.96之前，默认数量是3，HBase0.96之后改为1.</p>
<p><em>Example 13. 修改一个列族的最大版本数</em></p>
<blockquote>
<p>这个例子使用HBase Shell来修改列族 f1的最大版本数为5，你也可以使用 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HColumnDescriptor.html" target="_blank" rel="noopener">HColumnDescriptor</a>来实现。</p>
</blockquote>
<!--￼5-->
<p><em>Example 14. 修改一个列族的最小版本数Modify</em></p>
<blockquote>
<p>你也可以通过指定最小半本书来存储列族。默认情况下，该值为零，意味着这个属性是禁用的。下面的例子是通过HBase Shell设置列族f1中的所有列的最小版本数为2。你也可以通过 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/HColumnDescriptor.html" target="_blank" rel="noopener">HColumnDescriptor</a>来实现。</p>
</blockquote>
<!--￼6-->
<p>从HBase0.98.2开始，你可以通过设定在_hbase-site.xml_中设置hbase.column.max.version属性为所有新建的列指定一个全局的默认的最大版本数。</p>
<h3 id="版本和hbase-操作">版本和HBase 操作</h3>
<p>在这部分我们来看一下版本维度在HBase的每个核心操作中的表现。 #### Get/Scan Get是通过获取Scan的第一个数据来实现的。下面的讨论适用于 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Get.html" target="_blank" rel="noopener">Get</a> 和 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Scan.html" target="_blank" rel="noopener">Scans</a>.。</p>
<p>默认情况下，如果你没有指定明确的版本，当你执行一个Get操作时，那个版本为最大值的单元将被返回（可能是也可能不是最新写人的那个）。默认的行为可以通过下面方式来修改：</p>
<ul>
<li>返回不止一个版本 查看 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Get.html#setMaxVersions()" target="_blank" rel="noopener">Get.setMaxVersions()</a></li>
<li>返回最新版本以外的版本, 查看 <a href="http://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/Get.html#setTimeRange(long,%20long)" target="_blank" rel="noopener">Get.setTimeRange()</a></li>
</ul>
<p>想要获得小于或等于固定值的最新版本，仅仅通过使用一个0到期望版本的范围和设置最大版本数为1就可以实现获得一个特定时间点的最新版本的记录。</p>
<h4 id="默认的get-例子">默认的Get 例子</h4>
<p>下面例子仅仅返回行的当前版本。 <!--￼7--></p>
<h4 id="get版本的例">Get版本的例</h4>
<p>下面是获得行的最新3个版本的例子： <!--￼8--></p>
<h4 id="put-1">Put</h4>
<p>Put操作常常是以固定的时间戳来创建一个新单元。默认情况下，系统使用服务的 currentTimeMillis，但是你也可以为每一个列自己指定版本（长整型）。这就意味着你可以指定一个过去或者未来的时间点，或者不是时间格式的长整型。</p>
<p>为了覆盖已经存在的值，对和那个你想要覆盖的单元完全一样的row、column和version进行put操作。</p>
<p><em>隐式版本例子</em> 下面Put是以当前时间为版本的隐式操作 <!--￼9--></p>
<p><em>显示版本例子</em></p>
<p>下面的put是显示指定时间戳的操作。</p>
<!--￼10-->
<p>警告: 版本时间戳是HBase内部用来计算数据的存活时间的。它最好避免自己设置。最好是将时间戳作为行的单独属性或者作为key的一部分，或者两者都有。</p>
<h4 id="delete-1">Delete</h4>
<p>There are three different types of internal delete markers. See Lars Hofhansl’s blog for discussion of his attempt adding another, <a href="http://hadoop-hbase.blogspot.com/2012/01/scanning-in-hbase.html" target="_blank" rel="noopener">Scanning in HBase: Prefix Delete Marker</a>.</p>
<p>有三种不同的删除类型。可以看看Lars Hofhansl所写的博客 <a href="http://hadoop-hbase.blogspot.com/2012/01/scanning-in-hbase.html" target="_blank" rel="noopener">Scanning in HBase: Prefix Delete Marker</a>.</p>
<ul>
<li>Delete:列的指定版本</li>
<li>Delete column:列的所有版本</li>
<li>Delete family:特定列族里面的所有列。</li>
</ul>
<p>当要删除整个行时，HBase将会在内部为每一个列族创建一个墓碑。</p>
<p>删除通过创建一个墓碑标签来工作的。例如，让我们来设想我们要删除一个行。为此你可指定一个版本，或者使用默认的currentTimeMillis 。这就是删除小于等于该版本的所有单元。HBase不会修改数据，例如删除操作将不会立刻删除满足删除条件的文件。相反的，称为墓碑的会被写入，用来掩饰被删除的数据。当HBase执行一个压缩操作，墓碑将会执行一个真正地删除死亡值和墓碑自己的删除操作。如果你的删除操作指定的版本大于目前所有的版本，那么可以认为是删除整个行的数据。</p>
<p>你可以在 <a href="http://comments.gmane.org/gmane.comp.java.hadoop.hbase.user/28421" target="_blank" rel="noopener">Put w/timestamp → Deleteall → Put w/ timestamp fails</a> 用户邮件列表中查看关于删除和版本之间的相互影响的有益信息。</p>
<p>keyvalue也可以到<a href="http://hbase.apache.org/book.html#keyvalue" target="_blank" rel="noopener">keyvalue</a> 查看更多关于内部KeyValue格式的信息。</p>
<p>删除标签会在下一次仓库压缩操作中被清理掉，除非为列族设置了 KEEP_DELETED_CELLS (查看 <a href="http://hbase.apache.org/book.html#cf.keep.deleted" target="_blank" rel="noopener">Keeping Deleted Cells</a>)。为了保证删除时间的可配置性，你可以通过在 <em>hbase-site.xml</em> 。中hbase.hstore.time.to.purge.deletes属性来设置TTL（生存时间）。如果 hbase.hstore.time.to.purge.deletes没有设置或者设置为0，所有的删除标签包括哪些墓碑都会在下一次精简操作中被干掉。此外，未来带有时间戳的删除标签将会保持到发生在hbase.hstore.time.to.purge.deletes加上代表标签的时间戳的时间和的下一次精简操作。</p>
<blockquote>
<p>This behavior represents a fix for an unexpected change that was introduced in HBase 0.94, and was fixed in <a href="https://issues.apache.org/jira/browse/HBASE-10118" target="_blank" rel="noopener">HBASE-10118</a>. The change has been backported to HBase 0.94 and newer branches.</p>
</blockquote>
<h3 id="当前的局限性">当前的局限性</h3>
<h4 id="deletes-mask-puts删除覆盖插入更新">Deletes mask Puts删除覆盖插入/更新</h4>
<p>删除操作覆盖插入/更新操作，即使put在delete之后执行的。可以查看 <a href="https://issues.apache.org/jira/browse/HBASE-2256" target="_blank" rel="noopener">HBASE-2256</a>. 还记得一个删除写入一个墓碑，只有当下一次精简操作发生时才会执行真正地删除操作。假设你执行了一个删除全部小于等于T的操作。在此之外又做了一个时间戳为T的put操作。这个put操作即使是发生在delete之后，也会被delete墓碑所覆盖。执行put的时候不会报错，不过当你执行一个get的时候会发现执行无效。你会在精简操作之后重新开始工作。如果你在put的使用的递增的版本，那么这些问题将不会出现。但如果你不在意时间，在执行delelte后立刻执行put的话，那么它们将有可能发生在同一时间点，这将会导致上述问题的出现。 #### 精简操作影响查询结果 创建三个版本为t1,t2,t3的单元，并且设置最大版本数为2.所以当我们查询所有版本时，只会返回t2和t3。但是当你删除版本t2和t3的时候，版本t1会重新出现。显然，一旦重要精简工作运行之后，这样的行为就不会再出现。（查看 <a href="http://outerthought.org/blog/417-ot.html" target="_blank" rel="noopener">Bendingtime in HBase</a>.）</p>
<h2 id="排序次序">排序次序</h2>
<p>HBase中所有的数据模型操作返回的数据都是经过排序的。首先是行排序，其次是列族，接着是列限定符，最后是时间戳（递减排序，左右最新的记录最先返回）</p>
<h2 id="列元数据">列元数据</h2>
<p>所有列的元数据都存储在一个列族的内部KeyValue实例中。因此，HBsase不仅支持一行中有多列，而且支持行之间的列的差异多样化。跟踪列名是你的责任。</p>
<p>唯一获取一个列族的所有列的方法是处理所有的行。查看 <a href="http://hbase.apache.org/book.html#keyvalue" target="_blank" rel="noopener">keyvalue</a>获得更多关于HBase内部如何存储数据的信息。</p>
<h2 id="joins">Joins</h2>
<p>HBase是否支持join是一个常见的问题，答案是没有，至少没办法像RDBMS那样支持（例如等价式join或者外部join）。正如本章节所阐述的，HBase中读取数据的操作是Get和Scan。</p>
<p>然而，这不意味着等价式join功能没办法在你的应用中实现，但是你必须自己实现。两种主要策略是将数据非结构化地写到HBase中，或者查找表格然后在应用中或者MapReduce代码中实现join操作（正如RDBMS所演示的，将根据表格的大小会有几种不同的策略，例如嵌套使循环和hash-join）。哪个是最好的方法？这将依赖于你想做什么，没有一种方案能够应对各种情况。</p>
<h2 id="acid">ACID</h2>
<p>查看 <a href="http://hbase.apache.org/acid-semantics.html" target="_blank" rel="noopener">ACID Semantics</a>. Lars Hofhansl也写了一份报告 <a href="http://hadoop-hbase.blogspot.com/2012/03/acid-in-hbase.html" target="_blank" rel="noopener">ACID in HBase</a>.</p>

      
    </div>
    
    
    
    
    
    
    <div>
        
            <div>
    
        <div style="text-align:center;color: #ccc;font-size:14px;">-------------本文结束<i class="fa fa-paw"></i>感谢您的阅读-------------</div>
    
</div>
        
    </div>
    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JS库 sweetalert 可修改路径 -->
  <script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"></script>
  <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
  <p><span>本文标题:</span><a href="/hbase-001-data-model.html">Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 一打鹏 的个人博客">一打鹏</a></p>
  <p><span>发布时间:</span>2018年09月17日 - 13:09</p>
  <p><span>最后更新:</span>2018年09月17日 - 20:09</p>
  <p><span>原始链接:</span><a href="/hbase-001-data-model.html" title="Apache HBase ™ Reference Guide：Hbase官方指南3.0（一）「数据模型」">https://peniridis.github.io/hbase-001-data-model.html</a>
    <span class="copy-path"  title="点击复制文章链接"><i class="fa fa-clipboard" data-clipboard-text="https://peniridis.github.io/hbase-001-data-model.html"  aria-label="复制成功！"></i></span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">署名-非商业性使用-禁止演绎 4.0 国际</a> 转载请保留原文链接及作者。</p>
</div>
<script>
    var clipboard = new Clipboard('.fa-clipboard');
    $(".fa-clipboard").click(function(){
      clipboard.on('success', function(){
        swal({
          title: "",
          text: '复制成功',
          icon: "success",
          showConfirmButton: true
          });
	});
    });
</script>

      
    </div>
    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Hbase/" rel="tag"><i class="fa fa-tag"></i> Hbase</a>
          
            <a href="/tags/翻译/" rel="tag"><i class="fa fa-tag"></i> 翻译</a>
          
            <a href="/tags/Guide/" rel="tag"><i class="fa fa-tag"></i> Guide</a>
          
            <a href="/tags/大数据/" rel="tag"><i class="fa fa-tag"></i> 大数据</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/softexam-002-os.html" rel="next" title="软考（二）：操作系统">
                <i class="fa fa-chevron-left"></i> 软考（二）：操作系统
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/ajie.jpg"
                alt="一打鹏" />
            
              <p class="site-author-name" itemprop="name">一打鹏</p>
              <p class="site-description motion-element" itemprop="description">Great artist always hid themselves in their work.</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">5</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">6</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                神奇的链接
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://music.163.com/#/user/home?id=47611212" title="😆 网易云音乐 😆" target="_blank">😆 网易云音乐 😆</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.bilibili.com/video/av6211226/" title="尼古拉·特斯拉：发明了现代世界的人" target="_blank">尼古拉·特斯拉：发明了现代世界的人</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://peniridis.github.io/" title="关于此博客" target="_blank">关于此博客</a>
                  </li>
                
              </ul>
            <div id="days"></div>
<script>
function show_date_time(){
window.setTimeout("show_date_time()", 1000);
BirthDay=new Date("09/10/2018 00:00:00");
today=new Date();
timeold=(today.getTime()-BirthDay.getTime());
sectimeold=timeold/1000
secondsold=Math.floor(sectimeold);
msPerDay=24*60*60*1000
e_daysold=timeold/msPerDay
daysold=Math.floor(e_daysold);
e_hrsold=(e_daysold-daysold)*24;
hrsold=setzero(Math.floor(e_hrsold));
e_minsold=(e_hrsold-hrsold)*60;
minsold=setzero(Math.floor((e_hrsold-hrsold)*60));
seconds=setzero(Math.floor((e_minsold-minsold)*60));
document.getElementById('days').innerHTML="已运行"+daysold+"天"+hrsold+"小时"+minsold+"分"+seconds+"秒";
}
function setzero(i){
if (i<10)
{i="0" + i};
return i;
}
show_date_time();
</script>

            </div>
          
        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#数据模型"><span class="nav-number">1.</span> <span class="nav-text">数据模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#概念视图"><span class="nav-number">2.</span> <span class="nav-text">概念视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#物理视图"><span class="nav-number">3.</span> <span class="nav-text">物理视图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命名空间"><span class="nav-number">4.</span> <span class="nav-text">命名空间</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#命名空间管理"><span class="nav-number">4.1.</span> <span class="nav-text">命名空间管理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#预定义命名空间"><span class="nav-number">4.2.</span> <span class="nav-text">预定义命名空间</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表"><span class="nav-number">5.</span> <span class="nav-text">表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#行"><span class="nav-number">6.</span> <span class="nav-text">行</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列族"><span class="nav-number">7.</span> <span class="nav-text">列族</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#单元"><span class="nav-number">8.</span> <span class="nav-text">单元</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#数据模型操作"><span class="nav-number">9.</span> <span class="nav-text">数据模型操作</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#get"><span class="nav-number">9.1.</span> <span class="nav-text">Get</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#put"><span class="nav-number">9.2.</span> <span class="nav-text">Put</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#scans"><span class="nav-number">9.3.</span> <span class="nav-text">Scans</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#delete"><span class="nav-number">9.4.</span> <span class="nav-text">Delete</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#版本"><span class="nav-number">10.</span> <span class="nav-text">版本</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#指定版本的存储数量"><span class="nav-number">10.1.</span> <span class="nav-text">指定版本的存储数量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#版本和hbase-操作"><span class="nav-number">10.2.</span> <span class="nav-text">版本和HBase 操作</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#默认的get-例子"><span class="nav-number">10.2.1.</span> <span class="nav-text">默认的Get 例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#get版本的例"><span class="nav-number">10.2.2.</span> <span class="nav-text">Get版本的例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#put-1"><span class="nav-number">10.2.3.</span> <span class="nav-text">Put</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#delete-1"><span class="nav-number">10.2.4.</span> <span class="nav-text">Delete</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#当前的局限性"><span class="nav-number">10.3.</span> <span class="nav-text">当前的局限性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#deletes-mask-puts删除覆盖插入更新"><span class="nav-number">10.3.1.</span> <span class="nav-text">Deletes mask Puts删除覆盖插入/更新</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#排序次序"><span class="nav-number">11.</span> <span class="nav-text">排序次序</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#列元数据"><span class="nav-number">12.</span> <span class="nav-text">列元数据</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#joins"><span class="nav-number">13.</span> <span class="nav-text">Joins</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#acid"><span class="nav-number">14.</span> <span class="nav-text">ACID</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="heart">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">一打鹏</span>

  
</div>

<div class="powered-by">
<i class="fa fa-user-md"></i><span id="busuanzi_container_site_uv">
  本站访客数:<span id="busuanzi_value_site_uv"></span>
</span>
</div>

  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共9.2k字</span>
</div>
        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.min.js"></script>
  

  
  
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/velocity/1.2.1/velocity.ui.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>;
  <script>
  $("body").backstretch("https://i.loli.net/2018/09/10/5b966f426f928.jpeg");
  </script>
  <!-- 页面点击小红心 -->
  <script type="text/javascript" src="/js/src/love.js"></script><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->
</body>
</html>
